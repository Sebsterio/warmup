/*! warmup v0.0.1 | (c) 2020 Sebastian Rosloniec | ISC License | git+https://github.com/Sebsterio/warmup.git */
!(function(){const e=document.querySelector(".house"),t=e.querySelectorAll(".house__media"),{disableVideo:o,disableImages:n,disableYTEmbeds:i,forceYTEmbeds:r,YT_PARAMS:a,interval:d,ignorePriority:c,ignorePinned:l,profile:u}=houseConfig,{allMedia:s}=houseState;let f=[],m=[];const p=[...t].map(e=>({element:e,media:void 0}));function h(){(f=s.filter(e=>{const t=p.find(t=>!!t.media&&t.media.id===e.id),o=m.includes(e.id);if(!t&&!o)return e})).length||(f=[...s])}function w(e,t){for(let o in t)if(t[o]!==e[o])return!1;const{type:a}=e;if("video"===a&&!o)return!0;if("image"===a&&!n)return!0;if("YT embed"===a){if(r)return!0;if(!i&&window.innerWidth>800)return!0}return!1}function g(e,t){e.media=(function(e){for(;m.length<s.length;){f.length||h();const t=Math.floor(Math.random()*f.length),o=f.splice(t,1)[0];if(w(o,e))return o;m.push(o.id)}})(t),e.media&&(function({link:e,type:t,ratio:o},n){"image"===t&&window.houseApp.preloadImage(e,()=>{n.innerHTML=(function(e){return`<img class="image" src="${e}" alt=":)">`})(e)}),"video"===t&&window.houseApp.preloadVideo(e,()=>{n.innerHTML=(function(e){return`<video class="video" autoplay muted loop src="${e}"></video>`})(e)}),"YT embed"===t&&(n.innerHTML=createYTEmbed(e,o,n))})(e.media,e.element)}function b(){s.length&&(c||(p.forEach(e=>g(e,{priority:!0})),m=[],h()),p.forEach(e=>{e.media||g(e)}))}window.createYTEmbed=function(e,t,o){if(!o)throw new Error("YT embed error: invalid container");const n=Math.ceil(o.offsetHeight);t||(t=1.8);const i=e.split("?")[0],r=i.replace("https://www.youtube.com/embed/","").match(/[^\?\/]+/);return`<div class="embed"><iframe\n\t\t\tdata-ratio="${t}"\n\t\t\twidth="${n*t}px"\n\t\t\theight="${n}px"\n\t\t\tsrc="${i+(a+"&playlist="+r)}"\n\t\t\tframeborder="0"\n\t\t\tallow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"\n\t\t></iframe></div>`},window.houseApp.preloadImage=function(e,t){var o=new Image;o.src=e,o.onload=t},window.houseApp.preloadVideo=function(e,t){const o=document.createElement("video");o.src=e,o.onloadedmetadata=(()=>t())},window.houseApp.addCollection=function(t){s.push(...t),h(),b(),(function(){if(0===Number(d))return;let e=Math.floor(Math.random()*p.length);setInterval(()=>{const t=p[e];(l||t.media&&!t.media.pinned)&&g(t),e=e<p.length-1?e+1:0},Number(d))})(),e.querySelectorAll("video").forEach((e,t)=>{e.currentTime+=5*t})},houseApp.makeBackup=function(e="auto-backup"){localStorage.setItem(e,JSON.stringify(s))},houseApp.restoreBackup=function(e="auto-backup"){const t=JSON.parse(localStorage.getItem(e));houseState.allMedia=[...t],houseApp.addCollection(s)};const{addCollection:v,restoreBackup:y}=houseApp,A=u||"wuitw";window.houseApp.firestore.fetch(A,v,y),window.addEventListener("resize",(function(){p.forEach(e=>{const t=e.element,o=t.querySelector("iframe");if(!o)return;const n=Math.ceil(t.offsetHeight),i=o.dataset.ratio;o.width=n*i,o.height=n})}))})();